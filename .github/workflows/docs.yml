name: MkDocs Deploy

on:
    push:
        branches: [master]
        paths:
            - ".github/workflows/docs.yml"
            - "docs/**"
            - "mkdocs.yml"

permissions:
    contents: read

jobs:
    mkdocs-deploy:
        name: Deploy MkDocs site to GitHub Pages
        concurrency: mkdocs-deploy
        if: |
            github.actor != 'dependabot[bot]' &&
            github.actor != 'github-actions[bot]' &&
            github.actor != 'protected-auto-commits[bot]'
        runs-on: ubuntu-latest
        env:
            GOOGLE_ANALYTICS_ID: ${{ secrets.GOOGLE_ANALYTICS_ID }}
        steps:
            - name: Harden the runner
              uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a # v2.13.1
              with:
                  egress-policy: audit

            - name: Checkout Code
              uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

            - name: Configure Git Credentials
              run: |
                  git config user.name "github-actions[bot]"
                  git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

            - name: Setup Python
              uses: actions/setup-python@e797f83bcb11b83ae66e0230d6156d7c80228e7c # v6.0.0
              with:
                  python-version: "3.13"
                  cache: "pip"

            - name: Set Cache ID
              run: echo "cache_id=$(date --utc '+%V')" >> $GITHUB_ENV

            - name: Cache Dependencies
              uses: actions/cache@0057852bfaa89a56745cba8c7296529d2fc39830 # v4.3.0
              with:
                  path: ~/.cache/pip
                  key: mkdocs-material-${{ env.cache_id }}
                  restore-keys: |
                      mkdocs-material-

            - name: Install Dependencies
              run: pip install mkdocs-material mkdocs-mermaid2-plugin mkdocs-minify-plugin mkdocstrings-python

            - name: Deploy to GitHub Pages
              run: mkdocs gh-deploy --force
